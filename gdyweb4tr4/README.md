# 干瞪眼计分系统

## 项目简介
这是一个基于Flask开发的干瞪眼计分系统，用于记录和管理多人干瞪眼游戏的计分过程，并在游戏结束后生成详细的分数报告。

## 功能特点

1. **游戏设置**：允许用户设置玩家数量和玩家名称
2. **回合计分**：支持多轮游戏计分，自动计算获胜玩家得分
3. **结果展示**：游戏结束后展示排名和详细的回合历史记录
4. **PDF报告**：生成并下载包含完整游戏记录的PDF报告
5. **扁平化设计**：采用现代扁平化设计风格，提供良好的用户体验
6. **响应式布局**：支持在不同设备上良好显示

## 技术栈

- **后端框架**：Flask (Python)
- **数据库**：SQLite
- **PDF生成**：reportlab
- **前端技术**：HTML5, CSS3, JavaScript

## 项目结构

```
gameweb4tr3/
├── app.py                  # Flask应用主程序
├── templates/              # HTML模板目录
│   ├── index.html         # 登录页面
│   ├── setup.html         # 游戏设置页面
│   ├── scoring.html       # 计分页面
│   └── end_game.html      # 游戏结束页面
├── static/                 # 静态文件目录（存储生成的PDF报告）
├── fonts/                  # 字体文件目录
├── logs/                   # 日志文件目录
├── instance/               # 实例文件目录（包含SQLite数据库）
└── README.md               # 项目说明文档
```

## 安装与运行

### 环境要求
- Python 3.6+
- Flask
- reportlab
- 其他依赖库

### 安装步骤
1. 克隆或下载项目到本地
2. 安装依赖：`pip install -r requirements.txt`（如果有requirements.txt文件）
3. 直接运行：`python app.py`
4. 打开浏览器访问：`http://127.0.0.1:5002`

## 使用方法

1. **开始游戏**：访问首页后会自动跳转到游戏设置页面
2. **设置玩家**：选择玩家数量并输入玩家名称
3. **进行计分**：
   - 选择本轮获胜的玩家
   - 为其他玩家输入分数（输入正数会自动转换为负数）
   - 系统会自动计算获胜玩家的得分
4. **继续游戏**：点击"下一轮"继续游戏，或点击"结束游戏"完成
5. **查看结果**：游戏结束后会显示最终排名和回合历史
6. **下载报告**：可以下载包含完整游戏记录的PDF报告

## 计分规则

- 每轮游戏选择一名获胜玩家
- 其他玩家获得负分
- 获胜玩家获得的分数等于所有其他玩家负分的绝对值之和
- 所有玩家的总分在每轮结束后累计

## 开发说明

### 路由结构

- `/` - 默认重定向到游戏设置页面
- `/login` - 用户登录
- `/setup_game` - 游戏设置
- `/scoring` - 计分页面
- `/end_game` - 游戏结束页面
- `/download_pdf` - 下载PDF报告
- `/logout` - 退出登录
- `/debug` - 调试信息页面

### 数据存储

- 使用session存储当前游戏的状态和数据
- 使用SQLite数据库存储用户信息和历史记录

### 自定义设置

- 可以修改模板文件自定义页面样式
- 可以调整PDF报告的生成格式
- 可以扩展游戏规则和功能

## 注意事项

- 确保已安装所有必需的字体，特别是中文显示所需的字体
- 生成的PDF报告存储在static目录中
- 开发环境下建议使用Flask的调试模式

## Render.com部署说明

### 准备工作

1. 确保项目中包含以下文件：
   - `requirements.txt` - 包含所有项目依赖
   - `Procfile` - 定义如何启动应用
   - `.env` - 环境变量配置文件（可选，也可在Render.com界面设置）

2. 在项目根目录创建或确保存在以下文件：
   ```
   requirements.txt
   Procfile
   .env
   ```

### Render.com部署步骤

1. **创建Render账户**：访问 [Render.com](https://render.com) 并注册账户

2. **创建新服务**：
   - 登录后点击"New +"按钮
   - 选择"Web Service"

3. **连接仓库**：
   - 选择你的Git仓库（支持GitHub、GitLab、Bitbucket）
   - 如果仓库是私有的，按照提示授权Render访问

4. **配置服务**：
   - **Name**: 为你的服务命名
   - **Region**: 选择最近的区域
   - **Branch**: 选择要部署的分支（通常是main或master）
   - **Runtime**: 选择Python
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: 使用Procfile中定义的命令，通常是`gunicorn app:wsgi_app`

5. **配置环境变量**：
   - 点击"Advanced"展开高级选项
   - 在"Environment Variables"部分添加以下变量：
     - `SECRET_KEY`: 一个安全的密钥字符串
     - `DATABASE_URL`: Render.com PostgreSQL数据库连接字符串（在创建数据库后获取）

6. **创建PostgreSQL数据库**（可选但推荐）：
   - 在Render.com控制台点击"New +"按钮
   - 选择"PostgreSQL"
   - 配置数据库名称、用户名、密码等
   - 创建后复制数据库连接字符串并添加到Web Service的环境变量中

7. **部署服务**：
   - 点击"Create Web Service"开始部署
   - Render将自动构建并部署你的应用

### 部署后的配置

1. **域名设置**：
   - 部署成功后，你的应用将获得一个默认的`.onrender.com`域名
   - 可以在设置中添加自定义域名

2. **数据库迁移**：
   - 应用启动时会自动创建所需的数据库表（如果使用PostgreSQL）
   - 不需要手动运行迁移脚本

3. **日志查看**：
   - 在Render.com控制台可以查看应用的运行日志
   - 可以通过日志排查部署过程中的问题

### 注意事项

- Render.com的免费计划有一定的使用限制，包括每月免费运行时间和数据库大小
- 对于生产环境，建议使用付费计划以获得更好的性能和稳定性
- 确保`.env`文件中的敏感信息（如SECRET_KEY）不会提交到版本控制系统
- 在生产环境中，确保关闭了Flask的调试模式（DEBUG=False）

## 后续开发计划

1. 增加用户注册功能
2. 添加游戏历史记录查询
3. 支持更多游戏类型的计分规则
4. 实现多设备同步功能
5. 添加实时排行榜功能
6. 优化移动端用户体验